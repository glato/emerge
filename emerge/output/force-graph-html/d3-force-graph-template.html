<!DOCTYPE html>
<meta charset="utf-8">

<head>
    <!-- bootstrap css -->
    <link rel="stylesheet" type="text/css" href="vendors/bootstrap/css/bootstrap.css">
    <!-- custom css -->
    <link rel="stylesheet" type="text/css" href="resources/css/custom.css" />
    <!-- pdfkit and svg-to-pdfkit js -->
    <script src="vendors/pdfkit/pdfkit.standalone.js"></script>
    <script src="vendors/pdfkit/source.js"></script>
    <!-- jquery js -->
    <script type="text/javascript" src="vendors/jquery/jquery-3.5.1.min.js"></script>
    <!-- popper js -->
    <script type="text/javascript" src="vendors/popper/popper.min.js"></script>
    <!-- bootstrap js -->
    <script type="text/javascript" src="vendors/bootstrap/js/bootstrap.min.js"></script>
    <!-- d3 js -->
    <script type="text/javascript" src="vendors/d3/d3.v4.min.js"></script>
    <!-- exported graph representations as js -->
    <script type="text/javascript" src="resources/js/graph_representations_d3_force_graph.js"></script>

    <style>
        .dropdown-menu {
            width: 100%;
            text-align: left;
        }
        
        .controls-width {
            min-width: 210px;
        }
    </style>
</head>

<!-- this project uses embedded svg icons from the Bootstrap icon library - https://icons.getbootstrap.com -->
<div class="jumbotron" style="height: 100vh; margin-bottom: 0;">
    <div class="container-fluid">
        <div class="row d-flex justify-content-center">
            <div class="row">
                <div class="card">
                    <h6 class="card-header">Interactive graph for exploratory analysis</h6>
                    <div class="card-body">
                        <svg id="svg-container" width="1000" height="700"></svg>
                    </div>
                </div>
                <div class="card" style="min-width: 250px; max-width: 250px;">
                    <h6 class="card-header">
                        <span aria-hidden="true">
                            <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-controller" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                <path fill-rule="evenodd" d="M11.119 2.693c.904.19 1.75.495 2.235.98.407.408.779 1.05 1.094 1.772.32.733.599 1.591.805 2.466.206.875.34 1.78.364 2.606.024.815-.059 1.602-.328 2.21a1.42 1.42 0 0 1-1.445.83c-.636-.067-1.115-.394-1.513-.773a11.307 11.307 0 0 1-.739-.809c-.126-.147-.25-.291-.368-.422-.728-.804-1.597-1.527-3.224-1.527-1.627 0-2.496.723-3.224 1.527-.119.131-.242.275-.368.422-.243.283-.494.576-.739.81-.398.378-.877.705-1.513.772a1.42 1.42 0 0 1-1.445-.83c-.27-.608-.352-1.395-.329-2.21.024-.826.16-1.73.365-2.606.206-.875.486-1.733.805-2.466.315-.722.687-1.364 1.094-1.772.486-.485 1.331-.79 2.235-.98.932-.196 2.03-.292 3.119-.292 1.089 0 2.187.096 3.119.292zm-6.032.979c-.877.185-1.469.443-1.733.708-.276.276-.587.783-.885 1.465a13.748 13.748 0 0 0-.748 2.295 12.351 12.351 0 0 0-.339 2.406c-.022.755.062 1.368.243 1.776a.42.42 0 0 0 .426.24c.327-.034.61-.199.929-.502.212-.202.4-.423.615-.674.133-.156.276-.323.44-.505C4.861 9.97 5.978 9.026 8 9.026s3.139.943 3.965 1.855c.164.182.307.35.44.505.214.25.403.472.615.674.318.303.601.468.929.503a.42.42 0 0 0 .426-.241c.18-.408.265-1.02.243-1.776a12.354 12.354 0 0 0-.339-2.406 13.753 13.753 0 0 0-.748-2.295c-.298-.682-.61-1.19-.885-1.465-.264-.265-.856-.523-1.733-.708-.85-.179-1.877-.27-2.913-.27-1.036 0-2.063.091-2.913.27z"/>
                                <path d="M11.5 6.026a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm-1 1a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm2 0a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm-1 1a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0zm-7-2.5h1v3h-1v-3z"/>
                                <path d="M3.5 6.526h3v1h-3v-1zM3.051 3.26a.5.5 0 0 1 .354-.613l1.932-.518a.5.5 0 0 1 .258.966l-1.932.518a.5.5 0 0 1-.612-.354zm9.976 0a.5.5 0 0 0-.353-.613l-1.932-.518a.5.5 0 1 0-.259.966l1.932.518a.5.5 0 0 0 .612-.354z"/>
                            </svg>
                        </span> Controls
                    </h6>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item small d-flex justify-content-between align-items-center disabled py-1">
                                Graph properties
                            </li>
                            <li class="list-group-item small d-flex justify-content-between align-items-center py-1">
                                Nodes
                                <span class="badge badge-primary badge-pill" id="numberNodes">0</span>
                            </li>
                            <li class="list-group-item small d-flex justify-content-between align-items-center py-1">
                                Edges
                                <span class="badge badge-primary badge-pill" id="numberEdges">0</span>
                            </li>
                            <li class="list-group-item small d-flex justify-content-between align-items-center py-1">
                                Force
                                <span class="badge badge-primary badge-pill" id="force">0</span>
                            </li>
                        </ul>
                        <br>
                        <div class="btn-group-vertical controls-width">
                            <div class="btn-group">
                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle btn-with-spacing" id="selectGraphButton" data-toggle="dropdown">
                                Select graph
                                </button>
                                <div class="dropdown-menu" id="dropdown-graph" aria-labelledby="dropdown-graph">
                                    <!-- injected by js -->
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" onclick="saveAsPDF();">
                                <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-file-earmark-arrow-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M4 0h5.5v1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h1V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z"/>
                                    <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"/>
                                    <path fill-rule="evenodd" d="M8 6a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 1 1 .708-.708L7.5 10.293V6.5A.5.5 0 0 1 8 6z"/>
                                </svg>
                                Save graph as PDF
                            </button>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" class="btn btn-primary btn-sm btn-with-spacing btn-with-spacing-right" onclick="lessForce();">
                                    <span aria-hidden="true">
                                        <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-minus-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                            <path fill-rule="evenodd" d="M5.5 8a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1H6a.5.5 0 0 1-.5-.5z"/>
                                        </svg>
                                    </span>
                                    force
                                </button>
                                <button type="button" class="btn btn-primary btn-sm btn-with-spacing btn-with-spacing-left" onclick="moreForce();">
                                    <span aria-hidden="true">
                                        <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-plus-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                            <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                                        </svg>
                                    </span>
                                    force
                                </button>
                            </div>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" onclick="toggleNodeLabels();">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-info-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path d="M8.93 6.588l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588z"/>
                                        <circle cx="8" cy="4.5" r="1"/>
                                    </svg>
                                </span>
                                Toggle node labels
                            </button>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" onclick="zoomIn();">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-zoom-in" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                        <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                        <path fill-rule="evenodd" d="M6.5 3a.5.5 0 0 1 .5.5V6h2.5a.5.5 0 0 1 0 1H7v2.5a.5.5 0 0 1-1 0V7H3.5a.5.5 0 0 1 0-1H6V3.5a.5.5 0 0 1 .5-.5z"/>
                                    </svg>
                                </span>
                                Zoom in
                            </button>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" onclick="zoomOut();">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-zoom-out" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M6.5 12a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zM13 6.5a6.5 6.5 0 1 1-13 0 6.5 6.5 0 0 1 13 0z"/>
                                        <path d="M10.344 11.742c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1 6.538 6.538 0 0 1-1.398 1.4z"/>
                                        <path fill-rule="evenodd" d="M3 6.5a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5z"/>
                                    </svg>
                                </span>
                                Zoom out
                            </button>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" onclick="translateUp();">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-arrow-up-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path fill-rule="evenodd" d="M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"/>
                                    </svg>
                                </span>
                            </button>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <button type="button" class="btn btn-primary btn-sm btn-with-spacing btn-with-spacing-right" onclick="translateLeft();">
                                    <span aria-hidden="true">
                                        <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-arrow-left-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                            <path fill-rule="evenodd" d="M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"/>
                                        </svg>
                                    </span>
                                </button>
                                <button type="button" class="btn btn-primary btn-sm btn-with-spacing btn-with-spacing-right" onclick="resetTranslation();">
                                    <span aria-hidden="true">
                                        <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-arrows-move" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M7.646.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 1.707V5.5a.5.5 0 0 1-1 0V1.707L6.354 2.854a.5.5 0 1 1-.708-.708l2-2zM8 10a.5.5 0 0 1 .5.5v3.793l1.146-1.147a.5.5 0 0 1 .708.708l-2 2a.5.5 0 0 1-.708 0l-2-2a.5.5 0 0 1 .708-.708L7.5 14.293V10.5A.5.5 0 0 1 8 10zM.146 8.354a.5.5 0 0 1 0-.708l2-2a.5.5 0 1 1 .708.708L1.707 7.5H5.5a.5.5 0 0 1 0 1H1.707l1.147 1.146a.5.5 0 0 1-.708.708l-2-2zM10 8a.5.5 0 0 1 .5-.5h3.793l-1.147-1.146a.5.5 0 0 1 .708-.708l2 2a.5.5 0 0 1 0 .708l-2 2a.5.5 0 0 1-.708-.708L14.293 8.5H10.5A.5.5 0 0 1 10 8z"/>
                                        </svg>
                                    </span>
                                </button>
                                <button type="button" class="btn btn-primary btn-sm btn-with-spacing btn-with-spacing-left" onclick="translateRight();">
                                    <span aria-hidden="true">
                                        <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-arrow-right-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                            <path fill-rule="evenodd" d="M4 8a.5.5 0 0 0 .5.5h5.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H4.5A.5.5 0 0 0 4 8z"/>
                                        </svg>
                                    </span>
                                </button>
                            </div>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" onclick="translateDown();">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-arrow-down-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path fill-rule="evenodd" d="M8 4a.5.5 0 0 1 .5.5v5.793l2.146-2.147a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-3-3a.5.5 0 1 1 .708-.708L7.5 10.293V4.5A.5.5 0 0 1 8 4z"/>
                                    </svg>
                                </span>
                            </button>
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" data-toggle="modal" data-target="#exampleModal">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-graph-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5z"/>
                                    </svg>
                                </span>
                                Overall statistics
                            </button>
                            <!-- Modal -->
                            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="overallStatisticsModal" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="overallStatisticsModal">Overall statistics</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <table class="card-table table table-condensed">
                                                <thead class="table-borderless">
                                                    <tr>
                                                        <th scope="col">Statistic name</th>
                                                        <th scope="col">Value</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="tbody-statistics">
                                                    <!-- injected by js -->
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- end modal -->
                            <button type="button" class="btn btn-primary btn-sm btn-with-spacing" data-toggle="modal" data-target="#overallMetricsModal">
                                <span aria-hidden="true">
                                    <svg width="16px" height="16px" viewBox="0 0 18 18" class="bi bi-graph-up" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                        <path fill-rule="evenodd" d="M0 0h1v15h15v1H0V0zm10 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V4.9l-3.613 4.417a.5.5 0 0 1-.74.037L7.06 6.767l-3.656 5.027a.5.5 0 0 1-.808-.588l4-5.5a.5.5 0 0 1 .758-.06l2.609 2.61L13.445 4H10.5a.5.5 0 0 1-.5-.5z"/>
                                    </svg>
                                </span>
                                Overall metrics
                            </button>

                            <div class="btn-group">
                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle btn-with-spacing" data-toggle="dropdown"><span></span> <span class="caret"></span>Apply metrics</button>
                                <ul id="dropdown-apply-metric" class="dropdown-menu">
                                    <!-- injected by js -->
                                </ul>
                            </div>

                        </div>
                        <!-- Modal -->
                        <div class="modal fade" id="overallMetricsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Overall metrics</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <table class="card-table table table-condensed">
                                            <thead class="table-borderless">
                                                <tr>
                                                    <th scope="col">Statistic name</th>
                                                    <th scope="col">Value</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tbody-metrics">
                                                <!-- injected by js -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end modal -->
                        <br>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item small disabled">Move around, zoom in & out by scrolling, dragging or by using the controls, hover over nodes to get more details</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Some JS code is derived/borrowed or heavily inspired from demos/examples by the following people:
    // Mike Bostock - https://github.com/mbostock, https://bost.ocks.org/mike/
    // Tom Roth - https://bl.ocks.org/puzzler10/4438752bb93f45dc5ad5214efaa12e4a
    // Ma'moun othman/@mamounothman - https://stackoverflow.com/questions/61800343/d3-js-version-5-chart-to-pdf
    // Sam Leach/@SamuelLeach - https://gist.github.com/samuelleach/5497403
    // Pranav C Balan - https://stackoverflow.com/questions/41287778/get-all-possible-object-keys-from-a-list-of-objects-javascript-typescript
    // If I missed someone or gave wrong credit, please contact me and I'll update this.


    // TODO: scaling table to better visually represent metric results should be generated in python code
    var metricScaleTable = {
        "fan_in": 4.0,
        "fan_out": 4.0,
        "louvain_modularity": 5.0,
        "sloc": 0.5,
        "number_of_methods": 4.0
    }

    var data = {}
    var starting_with_graph = ''
        // check which graph instances are available and setup

    if (typeof file_result_dependency_graph !== 'undefined') {
        data['file_result_dependency_graph'] = {}
        data['file_result_dependency_graph']['graph'] = file_result_dependency_graph
        data['file_result_dependency_graph']['statistics'] = file_result_dependency_graph_statistics
        data['file_result_dependency_graph']['overall_metric_results'] =
            file_result_dependency_graph_overall_metric_results
        starting_with_graph = 'file_result_dependency_graph'
    }

    if (typeof file_result_inheritance_graph !== 'undefined') {
        data['file_result_inheritance_graph'] = {}
        data['file_result_inheritance_graph']['graph'] = file_result_inheritance_graph
        data['file_result_inheritance_graph']['statistics'] = file_result_inheritance_graph_statistics
        data['file_result_inheritance_graph']['overall_metric_results'] =
            file_result_inheritance_graph_overall_metric_results
    }

    if (typeof file_result_complete_graph !== 'undefined') {
        data['file_result_complete_graph'] = {}
        data['file_result_complete_graph']['graph'] = file_result_complete_graph
        data['file_result_complete_graph']['statistics'] = file_result_complete_graph_statistics
        data['file_result_complete_graph']['overall_metric_results'] = file_result_complete_graph_overall_metric_results
    }

    if (typeof entity_result_dependency_graph !== 'undefined') {
        data['entity_result_dependency_graph'] = {}
        data['entity_result_dependency_graph']['graph'] = entity_result_dependency_graph
        data['entity_result_dependency_graph']['statistics'] = entity_result_dependency_graph_statistics
        data['entity_result_dependency_graph']['overall_metric_results'] =
            entity_result_dependency_graph_overall_metric_results
        starting_with_graph = 'entity_result_dependency_graph'
    }

    if (typeof entity_result_inheritance_graph !== 'undefined') {
        data['entity_result_inheritance_graph'] = {}
        data['entity_result_inheritance_graph']['graph'] = entity_result_inheritance_graph
        data['entity_result_inheritance_graph']['statistics'] = entity_result_inheritance_graph_statistics
        data['entity_result_inheritance_graph']['overall_metric_results'] =
            entity_result_inheritance_graph_overall_metric_results
    }

    if (typeof entity_result_complete_graph !== 'undefined') {
        data['entity_result_complete_graph'] = {}
        data['entity_result_complete_graph']['graph'] = entity_result_complete_graph
        data['entity_result_complete_graph']['statistics'] = entity_result_complete_graph_statistics
        data['entity_result_complete_graph']['overall_metric_results'] =
            entity_result_complete_graph_overall_metric_results
    }

    if (typeof filesystem_graph !== 'undefined') {
        data['filesystem_graph'] = {}
        data['filesystem_graph']['graph'] = filesystem_graph
        data['filesystem_graph']['statistics'] = filesystem_graph_statistics
        data['filesystem_graph']['overall_metric_results'] = filesystem_graph_overall_metric_results
    }

    var currentGraphType
    var metricKeys
    var nodeLabelsVisible = false
    var currentTranslation = {
        horizontal: 0,
        vertical: 0
    }

    var hoverDiv

    var node, radius, color, link
    var svg = d3.select("svg"),
        width = +svg.attr("width"),
        height = +svg.attr("height");

    var nodes_data, links_data

    // group for the zoom 
    var g

    // d3 force simulation
    var simulation, charge_force, center_force, link_force, currentForce = -450

    var zoom_handler

    var url = document.location.href;
    const pdfExportName = 'graph.pdf'

    startWithGraph(starting_with_graph)

    graphSelectHtml = ""
    for (var key in data) {
        graphSelectHtml += '<button class="dropdown-item btn-sm" style="font-size: 10px;" type="button" onclick="startWithGraph(\''
        graphSelectHtml += key
        graphSelectHtml += '\');">'
        graphSelectHtml += key
        graphSelectHtml += "</button>"
    }

    d3.select("#dropdown-graph").html(graphSelectHtml)

    function clearEverything() {
        console.log("clearing everything")

        if (simulation !== undefined) {
            simulation.stop()
        }

        metricKeys = nodes_data = links_data = []
        link = node = nodes_data = links_data = undefined
        svg.selectAll("*").remove();
        simulation = charge_force = center_force = link_force = undefined
        d3.select("#node-label-tooltip").remove();
    }

    function moreForce() {
        startWithGraph(currentGraphType, currentForce + 100)
    }

    function lessForce() {
        startWithGraph(currentGraphType, currentForce - 100)
    }

    function startWithGraph(graphType, force = currentForce) {
        activeMetrics = []
        currentGraphType = graphType
        currentForce = force
        console.log("starting with graph type: " + graphType + " and force: " + currentForce)
        d3.select("#selectGraphButton").text(graphType.slice(0, 20) + '...')

        clearEverything()

        d3.select("svg"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        graph = JSON.parse(JSON.stringify(data[graphType]['graph']))
        statistics = data[graphType]['statistics']
        overall_metric_results = data[graphType]['overall_metric_results']

        nodes_data = graph.nodes
        console.log(graph.nodes)

        setGraphProperties()

        hoverDiv = d3.select("body").append("div")
            .attr("class", "tooltip")
            .attr("id", "node-label-tooltip")
            .style("opacity", 1e-6);

        radius = 14;
        color = d3.scaleOrdinal(d3.schemeCategory20);

        metricKeys = nodes_data.reduce(function(arr, o) {
            return Object.keys(o).reduce(function(a, k) {
                if (a.indexOf(k) == -1) {

                    // TODO: remove/filter in python before the export
                    if (graphType.includes('dependency')) {
                        console.log("graph type dependency")
                        if (!k.includes('inheritance') && !k.includes('complete')) {
                            if (k != "x" && k != "y" && k != "vx" && k != "vy" && k != "index" && k != "absolute_name" && k != "display_name" && k != "id") {
                                console.log("adding element to metric keys: " + k);
                                a.push(k);
                            }
                        }
                    }

                    if (graphType.includes('inheritance')) {
                        console.log("graph type inheritance")
                        if (!k.includes('dependency') && !k.includes('complete')) {
                            if (k != "x" && k != "y" && k != "vx" && k != "vy" && k != "index" && k != "absolute_name" && k != "display_name" && k != "id") {
                                console.log("adding element to metric keys: " + k);
                                a.push(k);
                            }
                        }
                    }

                    if (graphType.includes('complete')) {
                        console.log("graph type complete")
                        if (!k.includes('dependency') && !k.includes('inheritance')) {
                            if (k != "x" && k != "y" && k != "vx" && k != "vy" && k != "index" && k != "absolute_name" && k != "display_name" && k != "id") {
                                console.log("adding element to metric keys: " + k);
                                a.push(k);
                            }
                        }
                    }

                    if (graphType.includes('filesystem')) {
                        console.log("graph type filesystem")
                        if (!k.includes('dependency') && !k.includes('inheritance') && !k.includes('complete')) {
                            if (k != "x" && k != "y" && k != "vx" && k != "vy" && k != "index" && k != "absolute_name" && k != "display_name" && k != "id" && k != "directory" && k != "file") {
                                console.log("adding element to metric keys: " + k);
                                a.push(k);
                            }
                        }
                    }

                }
                return a;
            }, arr)
        }, []);

        links_data = graph.links

        // set up the simulation and add forces  
        simulation = d3.forceSimulation()
            .nodes(nodes_data);

        link_force = d3.forceLink(links_data)
            .id(function(d) {
                return d.id;
            });

        charge_force = d3.forceManyBody()
            .strength(currentForce);

        center_force = d3.forceCenter(width / 2, height / 2);

        simulation
            .force("charge_force", charge_force)
            .force("center_force", center_force)
            .force("links", link_force);

        // add tick instructions: 
        simulation.on("tick", tickActions);

        // add encompassing group for the zoom 
        g = svg.append("g")
            .attr("class", "everything");

        // draw lines for the links 
        link = g.append("g")
            .attr("class", "links")
            .selectAll("line")
            .data(links_data)
            .enter().append("line")
            .attr("stroke-width", 1)
            .style("stroke", linkColour);

        node = g.selectAll("circle")
            .data(nodes_data)
            .enter().append("g")
            .attr("class", "node")

        node.append("circle")
            .attr("r", radius)
            .attr("fill", circleColour)
            .style("fill-opacity", .7)
            .attr("stroke-width", 1)
            .style("stroke", "black")
            .on("mouseover", mouseover)
            .on("mousemove", function(d) {
                mousemove(d);
            })
            .on("mouseout", mouseout);

        node.append("text")
            .attr("dx", 15)
            .attr("dy", -5)
            .text(function(d) {
                return d.display_name;
            })
            .style("fill", "black")
            .style("fill-opacity", .7)
            .style("visibility", "hidden");

        // add drag capabilities  
        var drag_handler = d3.drag()
            .on("start", drag_start)
            .on("drag", drag_drag)
            .on("end", drag_end);

        drag_handler(node);

        // add zoom capabilities 
        zoom_handler = d3.zoom()
            .on("zoom", zoom_actions);

        zoom_handler(svg);

        scaleFactor = 0.1
        svg.call(zoom_handler.transform, d3.zoomIdentity.translate(0.5 * width * (1 - scaleFactor), 0.5 * height * (1 -
            scaleFactor)).scale(scaleFactor));

        let linkedByIndex = {};
        links_data.forEach((d) => {
            linkedByIndex[`${d.source.index},${d.target.index}`] = true;
        });

        function isConnected(a, b) {
            return isConnectedAsTarget(a, b) || isConnectedAsSource(a, b) || a.index === b.index;
        }

        function isConnectedAsSource(a, b) {
            return linkedByIndex[`${a.index},${b.index}`];
        }

        function isConnectedAsTarget(a, b) {
            return linkedByIndex[`${b.index},${a.index}`];
        }

        function circleColour(d) {
            //return "rgb(219, 237, 254)"
            if (currentGraphType.includes('file_result') || Â currentGraphType.includes('filesystem')) {
                return color(d.louvain_modularity_in_file)
            } else {
                return color(d.louvain_modularity_in_entity);
            }
        }

        function linkColour(d) {
            return "rgb(160, 160, 160)"
        }

        function mouseover(d) {

            hoverDiv.transition()
                .duration(0)
                .style("opacity", 1);

            const circle = d3.select(this);

            node
                .transition(250)
                .style('opacity', o => {
                    const isConnectedValue = isConnected(o, d);
                    if (isConnectedValue) {
                        return 1.0;
                    }
                    return 0.3
                })

            link
                .transition(250)
                .style('stroke-opacity', o => (o.source === d || o.target === d ? 1 : 0.1))
                .transition(250)
                .attr('marker-end', o => (o.source === d || o.target === d ? 'url(#arrowhead)' : 'url()'))
        }

        function mousemove(d) {
            var mouseOverHtmlString =
                "<table style='font-size: 10px; font-family: sans-serif; background-color: #fff;' >"
            mouseOverHtmlString +=
                "<tr><td style='padding: 4px; border-bottom: 1px solid #ccc; background-color: #ebebeb;'>"
            mouseOverHtmlString += "Node name"
            mouseOverHtmlString +=
                "</td><td style='padding: 4px; border-bottom: 1px solid #ccc; background-color: #ebebeb;'>"
            mouseOverHtmlString += d.display_name
            mouseOverHtmlString += "</td></tr>"

            for (var key in metricKeys) {
                if (metricKeys[key] == "id" || metricKeys[key] == "display_name" || metricKeys[key] == "absolute_name") {
                    continue
                }

                if (d.hasOwnProperty(metricKeys[key])) {
                    mouseOverHtmlString += "<tr><td style='padding: 4px; border-bottom: 1px solid #ccc;'>"
                    mouseOverHtmlString += metricKeys[key]
                    mouseOverHtmlString += "</td><td style='padding: 4px; border-bottom: 1px solid #ccc;'>"
                    mouseOverHtmlString += d[metricKeys[key]]
                    mouseOverHtmlString += "</td></tr>"
                }
            }
            mouseOverHtmlString += "</table>"

            hoverDiv
                .style("left", (d3.event.pageX + 10) + "px")
                .style("top", (d3.event.pageY) + "px")
                .html(mouseOverHtmlString);
        }

        function mouseout() {
            hoverDiv.transition()
                .duration(0)
                .style("opacity", 1e-6);

            node
                .transition(250)
                .style('opacity', o => {
                    return 1.0;
                })

            link
                .transition(250)
                .style('stroke-opacity', 0.6)
        }

        // Drag functions 
        function drag_start(d) {
            if (!d3.event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        // make sure you can't drag the circle outside the box
        function drag_drag(d) {
            d.fx = d3.event.x;
            d.fy = d3.event.y;
        }

        function drag_end(d) {
            if (!d3.event.active) simulation.alphaTarget(0.0);
            d.fx = null;
            d.fy = null;
        }

        // Zoom functions 
        function zoom_actions() {
            g.attr("transform", d3.event.transform)
        }

        function tickActions() {
            // update link positions 
            link
                .attr("x1", function(d) {
                    return d.source.x;
                })
                .attr("y1", function(d) {
                    return d.source.y;
                })
                .attr("x2", function(d) {
                    return d.target.x;
                })
                .attr("y2", function(d) {
                    return d.target.y;
                });

            node.attr("transform", function(d) {
                return "translate(" + d.x + "," + d.y + ")";
            });
        }

        // create statistics table
        statistics_html = ""
        for (var key in statistics) {
            if (statistics.hasOwnProperty(key)) {
                statistics_html += "<tr>"

                statistics_html += "<td>"
                statistics_html += key
                statistics_html += "</td>"

                statistics_html += "<td>"
                statistics_html += statistics[key]
                statistics_html += "</td>"

                statistics_html += "</tr>"
            }
        }
        d3.select("#tbody-statistics").html(statistics_html)

        // create metrics table
        metrics_html = ""
        for (var key in overall_metric_results) {
            if (overall_metric_results.hasOwnProperty(key)) {
                metrics_html += "<tr>"

                metrics_html += "<td>"
                metrics_html += key
                metrics_html += "</td>"

                metrics_html += "<td>"

                var valueString = String(overall_metric_results[key])
                if (valueString.length > 30) {
                    valueString = valueString.substring(0, 32) + '...';
                }

                metrics_html += String(valueString)
                metrics_html += "</td>"

                metrics_html += "</tr>"
            }
        }
        d3.select("#tbody-metrics").html(metrics_html)

        // create apply metrics menu entries
        applyMetricHtml = ""

        for (var key in metricKeys) {
            if (metricKeys[key] == "id") {
                continue
            }

            console.log("metric: " + metricKeys[key])

            applyMetricHtml += '<li> &nbsp; <input data-value="'
            applyMetricHtml += metricKeys[key]
            applyMetricHtml += '" type="checkbox" onclick="applyMetrics(this);"/>&nbsp; <span class="badge badge-secondary" style="font-size:10px;">'
            applyMetricHtml += metricKeys[key]
            applyMetricHtml += '</span> &nbsp;</li>'
        }

        d3.select("#dropdown-apply-metric").html(applyMetricHtml)
    }

    function setGraphProperties() {
        d3.select("#numberNodes").text(graph.nodes.length)
        d3.select("#numberEdges").text(graph.links.length)
        d3.select("#force").text(currentForce)
    }

    var activeMetrics = []

    function applyMetrics(d) {
        var metric = d.getAttribute("data-value")
        if (activeMetrics.includes(metric)) {
            removeItemAll(activeMetrics, metric)
        } else {
            activeMetrics.push(metric)
        }

        node.selectAll("circle")
            .transition()
            .duration(250)
            .attr("r", function(nodeAttributes) {

                // this resets all nodes back to the default radius
                if (activeMetrics.length == 0) {
                    return radius
                }

                // else iterate over all checked metrics and multiply values
                var nodeMetricValue = 0
                activeMetrics.forEach((metricName) => {

                    var currentValue = nodeAttributes[metricName]
                    if (currentValue == undefined) {
                        if (nodeMetricValue == 0) {
                            nodeMetricValue = 1
                        }
                    } else if (currentValue == 0) {
                        if (nodeMetricValue == 0) {
                            nodeMetricValue = 1
                        }
                    } else {
                        nodeMetricValue = nodeMetricValue + currentValue
                    }

                    // apply post-scaling for metric values to better visually represent metric impacts
                    Object.keys(metricScaleTable).forEach(function(key) {
                        if (metricName.includes(key)) {
                            nodeMetricValue = nodeMetricValue * metricScaleTable[key]
                        }
                    });

                });

                var smoothedRadius = Math.pow(1.5 * Math.log10(nodeMetricValue), 3) + radius
                return smoothedRadius

            });
    }

    // borrowed from https://stackoverflow.com/questions/5767325/how-can-i-remove-a-specific-item-from-an-array
    function removeItemAll(arr, value) {
        var i = 0;
        while (i < arr.length) {
            if (arr[i] === value) {
                arr.splice(i, 1);
            } else {
                ++i;
            }
        }
        return arr;
    }

    function toggleNodeLabels() {
        if (nodeLabelsVisible == false) {
            node
                .select("text")
                .style("visibility", "visible")
            nodeLabelsVisible = true
        } else {
            node
                .select("text")
                .style("visibility", "hidden")
            nodeLabelsVisible = false
        }
    }

    function zoomIn() {
        svg.transition().call(zoom_handler.scaleBy, 2)
    }

    function zoomOut() {
        svg.transition().call(zoom_handler.scaleBy, 0.5)
    }

    function translateRight() {
        currentTranslation.horizontal += 50
        svg.transition().call(zoom_handler.transform, d3.zoomIdentity.translate(0.5 * width * (1 - scaleFactor) +
                currentTranslation.horizontal, 0.5 * height * (1 - scaleFactor) + currentTranslation.vertical)
            .scale(scaleFactor))
    }

    function translateLeft() {
        currentTranslation.horizontal -= 50
        svg.transition().call(zoom_handler.transform, d3.zoomIdentity.translate(0.5 * width * (1 - scaleFactor) +
                currentTranslation.horizontal, 0.5 * height * (1 - scaleFactor) + currentTranslation.vertical)
            .scale(scaleFactor))
    }

    function translateUp() {
        currentTranslation.vertical -= 50
        svg.transition().call(zoom_handler.transform, d3.zoomIdentity.translate(0.5 * width * (1 - scaleFactor) +
                currentTranslation.horizontal, 0.5 * height * (1 - scaleFactor) + currentTranslation.vertical)
            .scale(scaleFactor));
    }

    function translateDown() {
        currentTranslation.vertical += 50
        svg.transition().call(zoom_handler.transform, d3.zoomIdentity.translate(0.5 * width * (1 - scaleFactor) +
                currentTranslation.horizontal, 0.5 * height * (1 - scaleFactor) + currentTranslation.vertical)
            .scale(scaleFactor));
    }

    function resetTranslation() {
        currentTranslation.vertical = 0
        currentTranslation.horizontal = 0
        svg.transition().call(zoom_handler.transform, d3.zoomIdentity.translate(0.5 * width * (1 - scaleFactor) +
                currentTranslation.horizontal, 0.5 * height * (1 - scaleFactor) + currentTranslation.vertical)
            .scale(scaleFactor));
    }

    const convertSVGToPDF = (svg) => {
        const doc = new window.PDFDocument();
        const chunks = [];
        const stream = doc.pipe({
            // writable stream implementation
            write: (chunk) => chunks.push(chunk),
            end: () => {
                const pdfBlob = new Blob(chunks, {
                    type: "application/octet-stream",
                });
                var blobUrl = URL.createObjectURL(pdfBlob);
                const a = document.createElement("a");
                document.body.appendChild(a);
                a.style = "display: none";
                a.href = blobUrl;
                a.download = pdfExportName;
                a.click();
                window.URL.revokeObjectURL(url);
            },
            on: (event, action) => {},
            once: (...args) => {},
            emit: (...args) => {},
        });
        window.SVGtoPDF(doc, svg, 0, 0);
        doc.end();
    };

    function saveAsPDF() {
        const svgElement = document.getElementById("svg-container");
        convertSVGToPDF(svgElement.innerHTML);
    }
</script>